# VaspTools

VaspTools is a relatively file agnostic utility for VASP output files. You are only required to have the `vasprun.xml` file at a minium. 
This package can be used to pull properties from a completed VASP calculation. Most properties are returned as either numpy arrays or pandas dataframes for ease of use. 

## Current Callable Attributes

| Title | Property | Type | Description |
| --- | --- | --- | --- |
| Initial Basis Vectors | `structure.initial_basis` | `np.array` | The initial basis vectors of the unit cell. |
| Initial Reciprocal Vectors | `structure.initial_reciprocal_basis` | `np.array` | The initial reciprocal vectors of the unit cell. |
| Initial Positions | `structure.initial_positions` | `np.array` | The initial positions of the atoms in the unit cell (x, y, z). |
| Final Basis Vectors | `structure.final_basis` | `np.array` | The final basis vectors of the unit cell. |
| Final Reciprocal Vectors | `structure.final_reciprocal_basis` | `np.array` | The final reciprocal vectors of the unit cell. |
| Final Positions | `structure.final_positions` | `np.array` | The final positions of the atoms in the unit cell (x, y, z). |
| Incar Tags | 'incar_dict' | `structure.dict` | User supplied INCAR tags and their values. |
| Kpoints | `kpoints` | `np.array` | The kpoints used in the calculation. |
| Kpoint Weights | `kpoint_weights` | `np.array` | The kpoint weights used in the calculation. |
| Kpoint Grid Type | `kpoint_grid_type` | `str` | The type of kpoint grid used in the calculation. |
| Kpoint linemode Divisions | `kpoint_linemode_divisions` | `np.array` | The kpoint linemode divisions used in the calculation. |
| Kpath | `kpath` | `np.array` | The kpoint values used to build the kpath |
| Kpath Labels | `kpath_labels` | `list[str]` | The labels for the kpoints used to build the kpath (only available if KPOINTS file is present)|
| Merged Kpath Labels | `merged_kpath_labels` | `list[str]` | Kpath labels used for plotting (handles discontinuities). |
| Atom Count | `atom_count` | `int` | The number of atoms in the unit cell. |
| Atom Types | `atom_types` | `list[str]` | The types of atoms in the unit cell. |
| Number of Unique Atoms | `unique_atom_count` | `int` | The number of unique atoms in the unit cell. |
| Reduced Formula | `formula` | `str` | The reduced formula of the unit cell (does not handle subscripts). |
| Eigenvalues | `eigenvalues` | `pd.DataFrame` | Spin resolved eigenvalues |
| Fermi Energy | `fermi_energy` | `float` | Fermi Energy. |
| Density of States | `dos` | `DensityOfStates` | DensityOfStates is a custom class that handles total, partial, and projected DOS |
| Band Structure | `bands` | `BandStructure` | BandStructure is a custom class that handles all band related values |

## Current Class Methods

| Function | Input | Output | Description |
| --- | --- | --- | --- |
| `write_kpoints()` | self, save path | None | Writes an explicit kpoint mesh generated by vasp |
| `write_incar()` | self, save path | None | Writes an INCAR of the user specified tags |
|`write_input_files()` | self, save directory, optional titles | Writes the POSCAR, KPOINTS, and INCAR files from the vasprun.xml file. Also prints command line command to create a POTCAR |

___



## DensityOfStates Class

The DensityOfStates class is used to handle the density of states data. It is returned as the `dos` attribute of the `Vasprun` class. 

Warning: The projected DOS is currently very slow to parse, it is recommended that you use the `cprojected` function first to create a `vrpoj.pkl` file that will be saved to the current working directory. 
This is not the current default behavior because it is impolite to make files on someone's computer without consent.

### DensityOfStates Attributes
| Title | Property | Type | Description | Columns |
| --- | --- | --- | --- | --- |
| Total DOS | `total` | `pd.DataFrame` | Total DOS | `energy`, `total`, `integrated` | 
| Partial DOS | `partial` | `pd.DataFrame` | Partial DOS | `ion`, `spin`,  `energy`, and all orbital types | 
| Projected DOS | `projected` | `pd.DataFrame` | Projected DOS | `ion`, `spin`, `band`, `energy`, and all orbital types |
___

## Plotting Utilities

Since most attributes are returned as numpy arrays or pandas dataframes, plotting is relatively easy. Regardless, there are a few plotting utilities included in the package for convenience. They are rather crude at the moment and could benefit from more love and time

___

## BandStructure Class

The BandStructure class is used to handle information pertaining to each band, the associated kpoints, and other relevant information. It is returned as the `bands` attribute of the Vasprun class.

## Plotting Utilities

Conventional and 3D band structure plotting utilities are available. In addition, you may plot bands as various types of contour plots and heatmaps that are reminiscent to ARPES spectra.  
___

## Example Usage


### Plot total dos of a spin polarized calculation
```python
from vasprun import Vasprun
from dosPlotter import plot_total_dos, plot_partial_dos

vasprun = Vasprun("vasprun.xml")
plot_total_dos(vasprun.dos.total, is_spin=True)
 ```

 ### Plot a 3D band structure of the HOMO and LUMO of a noncollinear calculation
 ```python
 from vasprun import Vasprun
 vasprun = Vasprun("vasprun.xml")
 vasprun.bands.plot_3d([40,42])
 ```

![3d_band](https://user-images.githubusercontent.com/94595045/227369719-6067b58a-ee23-4840-a2c5-10cb29d97314.png)


 ### Compare Band Structures two Different Calculations
 ```python
 vasprun1 = Vasprun('vasprun1.xml')
 vasprun2 = Vasprun('vasprun2.xml')
 labels = vasprun1.kpath_labels #only available if KPOINTS file is in the current directory
 compare_bands(vasprun1, vasprun2, emin=-2, emax=2, labels = labels)
```



